<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CVForge AI Smart</title>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        :root { --p: #6366f1; --s: #0ea5e9; --ai: #db2777; }
        body { font-family: 'Cairo', sans-serif; background: #f8fafc; margin: 0; padding-bottom: 50px; }
        .card { max-width: 500px; margin: 20px auto; background: white; padding: 25px; border-radius: 20px; box-shadow: 0 10px 25px rgba(0,0,0,0.05); }
        .input-box { margin-bottom: 15px; }
        label { display: block; font-size: 13px; font-weight: bold; margin-bottom: 5px; color: #475569; }
        input, textarea { width: 100%; padding: 12px; border: 2px solid #f1f5f9; border-radius: 10px; box-sizing: border-box; outline: none; font-family: inherit; }
        .ai-btn { background: #fdf2f8; color: var(--ai); border: 1px solid #fbcfe8; padding: 6px 12px; border-radius: 8px; font-size: 11px; font-weight: bold; cursor: pointer; float: left; transition: 0.3s; }
        .ai-btn:hover { background: var(--ai); color: white; }
        .main-btn { width: 100%; padding: 15px; background: var(--p); color: white; border: none; border-radius: 12px; font-weight: bold; font-size: 16px; cursor: pointer; margin-top: 10px; }
    </style>
</head>
<body>

    <div style="text-align: center; padding: 20px; background: white; border-bottom: 1px solid #eee;">
        <h2 style="margin:0; color: var(--p);">CVForge AI <i class="fas fa-robot"></i></h2>
    </div>

    <div class="card">
        <div class="input-box"><label>الاسم</label><input type="text" id="name"></div>
        <div class="input-box"><label>المسمى الوظيفي (أهم خانة للـ AI)</label><input type="text" id="job" placeholder="مثلاً: محاسب"></div>
        
        <div class="input-box">
            <button class="ai-btn" onclick="askAI()"><i class="fas fa-magic"></i> توليد ذكي</button>
            <label>النبذة الشخصية</label>
            <textarea id="about" rows="4" placeholder="اضغط على توليد ذكي للمساعدة..."></textarea>
        </div>

        <button class="main-btn" onclick="makePDF()">تحميل السيرة الذاتية PDF</button>
    </div>

    <div id="print-area" style="position: absolute; left: -9999px; width: 210mm; background: white; padding: 40px;">
        <h1 id="p-name" style="color: #1e293b; margin:0;"></h1>
        <h3 id="p-job" style="color: #6366f1; margin-top:5px;"></h3>
        <hr>
        <h4>النبذة الشخصية</h4>
        <p id="p-about" style="line-height: 1.6; color: #334155;"></p>
    </div>

    <script>
        const KEY = "AIzaSyBowgZXd1c24OQKFoVkqJYvs3BjEKgV8mc";

        async function askAI() {
            const jobTitle = document.getElementById('job').value;
            const aboutBox = document.getElementById('about');
            if(!jobTitle) return alert("من فضلك اكتب الوظيفة أولاً");

            const btn = event.currentTarget;
            btn.innerHTML = "جاري التفكير...";
            btn.disabled = true;

            try {
                // محاولة الاتصال بـ Gemini
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${KEY}`, {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({
                        contents: [{ parts: [{ text: `اكتب نبذة مهنية قصيرة جداً (سطرين) باللغة العربية لشخص يعمل ${jobTitle}` }] }]
                    })
                });

                const data = await response.json();
                
                if (data.candidates && data.candidates[0].content.parts[0].text) {
                    aboutBox.value = data.candidates[0].content.parts[0].text.trim();
                } else {
                    throw new Error("No Data");
                }
            } catch (err) {
                // خطة بديلة (Backup) في حال فشل الـ AI أو الأمان
                console.log("AI Failed, using backup...");
                aboutBox.value = `محترف متمرس في مجال ${jobTitle}، أمتلك مهارات عالية وقدرة على تحقيق الأهداف المطلوبة بدقة واحترافية، وأسعى دائماً للتطوير المستمر.`;
                alert("تم استخدام نص احترافي بديل (تأكد من تفعيل الـ API بعد قليل)");
            } finally {
                btn.innerHTML = '<i class="fas fa-magic"></i> توليد ذكي';
                btn.disabled = false;
            }
        }

        async function makePDF() {
            document.getElementById('p-name').innerText = document.getElementById('name').value;
            document.getElementById('p-job').innerText = document.getElementById('job').value;
            document.getElementById('p-about').innerText = document.getElementById('about').value;

            const canvas = await html2canvas(document.getElementById('print-area'));
            const pdf = new jspdf.jsPDF('p', 'mm', 'a4');
            pdf.addImage(canvas.toDataURL('image/png'), 'PNG', 0, 0, 210, 297);
            pdf.save('My_CV.pdf');
        }
    </script>
</body>
</html>
