<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CVForge AI | Platinum Edition</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700;900&family=Almarai:wght@400;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    
    <style>
        :root { --primary: #1a5f7a; --secondary: #0ea5e9; --text-dark: #1e293b; --text-light: #64748b; }
        body { margin: 0; background: #f1f5f9; font-family: 'Cairo', sans-serif; transition: 0.4s; }

        /* الواجهة الأمامية (المحرر) */
        header { background: white; padding: 15px; text-align: center; border-bottom: 2px solid var(--primary); box-shadow: 0 2px 10px rgba(0,0,0,0.05); }
        .app-container { max-width: 700px; margin: 30px auto; padding: 0 15px; }
        .editor-card { background: white; padding: 30px; border-radius: 20px; box-shadow: 0 15px 35px rgba(0,0,0,0.1); }
        
        .input-group { margin-bottom: 20px; }
        label { display: block; font-weight: 700; margin-bottom: 8px; color: var(--text-dark); font-size: 14px; }
        input, textarea { width: 100%; padding: 12px; border: 2px solid #e2e8f0; border-radius: 10px; font-family: inherit; outline: none; transition: 0.3s; box-sizing: border-box; }
        input:focus { border-color: var(--primary); background: #f8fafc; }

        .theme-panel { background: #f8fafc; padding: 15px; border-radius: 15px; margin: 20px 0; border: 1px solid #e2e8f0; text-align: center; }
        .color-dots { display: flex; justify-content: center; gap: 15px; margin-top: 10px; }
        .dot { width: 35px; height: 35px; border-radius: 50%; cursor: pointer; border: 3px solid white; box-shadow: 0 4px 6px rgba(0,0,0,0.1); transition: 0.3s; }
        .dot.active { transform: scale(1.2); border-color: #334155; }

        .btn-download { 
            width: 100%; padding: 20px; background: var(--primary); color: white; border: none; 
            border-radius: 15px; font-size: 18px; font-weight: 900; cursor: pointer; 
            position: relative; overflow: hidden; transition: 0.3s; display: flex; align-items: center; justify-content: center; gap: 10px;
        }
        .btn-download:hover { opacity: 0.9; transform: translateY(-2px); }
        .progress-line { position: absolute; bottom: 0; left: 0; height: 5px; background: var(--secondary); width: 0%; transition: 0.2s; }

        /* --- تصميم الـ PDF عالي الدقة (مثل الصورة) --- */
        #pdf-hideout { position: absolute; left: -9999px; top: 0; }
        .cv-page { width: 210mm; height: 297mm; background: white; position: relative; display: flex; flex-direction: column; }
        
        .cv-header { background: var(--primary); height: 220px; width: 100%; position: relative; display: flex; align-items: center; padding: 0 60px; color: white; box-sizing: border-box; }
        .cv-header-content { flex: 1; }
        .cv-header-content h1 { font-family: 'Almarai'; font-size: 45px; margin: 0; font-weight: 800; letter-spacing: -1px; }
        .cv-header-content p { font-size: 22px; opacity: 0.9; margin: 5px 0 0; font-weight: 400; }
        
        .photo-frame { width: 180px; height: 180px; border-radius: 50%; border: 8px solid white; overflow: hidden; position: absolute; left: 60px; top: 50%; transform: translateY(-50%); background: #eee; }
        .photo-frame img { width: 100%; height: 100%; object-fit: cover; }

        .cv-body { display: grid; grid-template-columns: 1fr 320px; flex: 1; }
        
        /* العمود الأيمن (الرئيسي) */
        .main-col { padding: 40px 50px 40px 30px; }
        .sec-title { display: flex; align-items: center; gap: 12px; color: var(--primary); font-size: 20px; font-weight: 800; margin-bottom: 20px; border-bottom: 2px solid #f1f5f9; padding-bottom: 10px; }
        .sec-title i { font-size: 18px; }
        .entry-box { margin-bottom: 25px; position: relative; padding-right: 20px; border-right: 2px solid #f1f5f9; }
        .entry-box::before { content: ""; position: absolute; right: -6px; top: 8px; width: 10px; height: 10px; background: var(--primary); border-radius: 50%; }
        .entry-text { font-size: 15px; color: #334155; line-height: 1.7; white-space: pre-line; }

        /* العمود الأيسر (الجانبي) */
        .side-col { background: #f8fafc; padding: 40px 30px; border-right: 1px solid #e2e8f0; }
        .side-title { background: var(--primary); color: white; padding: 8px 20px; border-radius: 20px; font-size: 16px; font-weight: 700; margin-bottom: 20px; text-align: center; }
        .info-item { display: flex; align-items: center; gap: 12px; margin-bottom: 15px; color: #475569; font-size: 14px; }
        .info-item i { color: var(--primary); width: 20px; text-align: center; }
        
        .skill-tag { background: white; border: 1px solid #e2e8f0; padding: 5px 15px; border-radius: 8px; display: inline-block; margin: 0 0 8px 8px; font-size: 13px; font-weight: 600; color: var(--primary); }
    </style>
</head>
<body>

    <header>
        <div style="font-size: 24px; font-weight: 900; color: var(--primary);">
            <i class="fas fa-gem"></i> CVForge <span style="color: var(--secondary);">Platinum</span>
        </div>
    </header>

    <div class="app-container">
        <div class="editor-card">
            <div class="input-group"><label>الاسم الكامل</label><input type="text" id="inName" oninput="saveData()" placeholder="مثال: محمد مراد"></div>
            <div class="input-group"><label>المسمى الوظيفي</label><input type="text" id="inJob" oninput="saveData()" placeholder="مثال: مصمم جرافيك"></div>
            
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                <div class="input-group"><label>الهاتف</label><input type="text" id="inPhone" oninput="saveData()"></div>
                <div class="input-group"><label>البريد الإلكتروني</label><input type="email" id="inEmail" oninput="saveData()"></div>
            </div>

            <div class="input-group"><label>الصورة الشخصية</label><input type="file" id="inPhoto" accept="image/*"></div>
            <div class="input-group"><label>لمحة شخصية (Summary)</label><textarea id="inAbout" oninput="saveData()" rows="4"></textarea></div>
            <div class="input-group"><label>الخبرة المهنية</label><textarea id="inExp" oninput="saveData()" rows="5"></textarea></div>
            <div class="input-group"><label>التعليم</label><textarea id="inEdu" oninput="saveData()" rows="3"></textarea></div>
            <div class="input-group"><label>المهارات (افصل بينها بفاصلة)</label><input type="text" id="inSkills" oninput="saveData()"></div>

            <div class="theme-panel">
                <label>اختر هوية اللون المفضلة</label>
                <div class="color-dots">
                    <div class="dot active" style="background: #1a5f7a;" onclick="setTheme('#1a5f7a', this)"></div>
                    <div class="dot" style="background: #1e293b;" onclick="setTheme('#1e293b', this)"></div>
                    <div class="dot" style="background: #7c3aed;" onclick="setTheme('#7c3aed', this)"></div>
                    <div class="dot" style="background: #059669;" onclick="setTheme('#059669', this)"></div>
                </div>
            </div>

            <button class="btn-download" id="dlBtn" onclick="generatePDF()">
                <i class="fas fa-file-export"></i>
                <span id="btnText">توليد السيرة الذاتية بدقة عالية</span>
                <div class="progress-line" id="pLine"></div>
            </button>
            <p id="status" style="text-align:center; font-weight:700; margin-top:15px;"></p>
        </div>
    </div>

    <div id="pdf-hideout">
        <div id="cv-target" class="cv-page">
            <div class="cv-header" id="pdfHeader">
                <div class="cv-header-content">
                    <h1 id="outName"></h1>
                    <p id="outJob"></p>
                </div>
                <div class="photo-frame">
                    <img id="outPhoto" src="">
                </div>
            </div>

            <div class="cv-body">
                <div class="main-col">
                    <div class="sec-title"><i class="fas fa-briefcase"></i> الخبرة المهنية</div>
                    <div class="entry-box"><div id="outExp" class="entry-text"></div></div>

                    <div class="sec-title" style="margin-top:40px;"><i class="fas fa-graduation-cap"></i> التعليم</div>
                    <div class="entry-box"><div id="outEdu" class="entry-text"></div></div>
                </div>

                <div class="side-col">
                    <div class="side-title">لمحة شخصية</div>
                    <div id="outAbout" style="font-size: 14px; line-height: 1.6; color: #334155; margin-bottom: 30px;"></div>

                    <div class="side-title">التواصل</div>
                    <div class="info-item"><i class="fas fa-phone"></i> <span id="outPhone"></span></div>
                    <div class="info-item" style="word-break: break-all;"><i class="fas fa-envelope"></i> <span id="outEmail"></span></div>

                    <div class="side-title" style="margin-top:30px;">المهارات</div>
                    <div id="outSkills"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const fields = ['inName', 'inJob', 'inPhone', 'inEmail', 'inAbout', 'inExp', 'inEdu', 'inSkills'];

        function setTheme(color, el) {
            document.documentElement.style.setProperty('--primary', color);
            document.querySelectorAll('.dot').forEach(d => d.classList.remove('active'));
            el.classList.add('active');
            localStorage.setItem('prefColor', color);
        }

        window.onload = () => {
            fields.forEach(f => {
                const val = localStorage.getItem(f);
                if(val) document.getElementById(f).value = val;
            });
            const savedColor = localStorage.getItem('prefColor');
            if(savedColor) setTheme(savedColor, document.querySelector(`[style*="${savedColor}"]`));
        };

        function saveData() {
            fields.forEach(f => localStorage.setItem(f, document.getElementById(f).value));
        }

        document.getElementById('inPhoto').onchange = e => {
            const reader = new FileReader();
            reader.onload = () => document.getElementById('outPhoto').src = reader.result;
            reader.readAsDataURL(e.target.files[0]);
        };

        async function generatePDF() {
            const btn = document.getElementById('dlBtn');
            const bar = document.getElementById('pLine');
            const status = document.getElementById('status');
            
            // تعبئة البيانات
            document.getElementById('outName').innerText = document.getElementById('inName').value || "الاسم الكامل";
            document.getElementById('outJob').innerText = document.getElementById('inJob').value || "المسمى الوظيفي";
            document.getElementById('outExp').innerText = document.getElementById('inExp').value;
            document.getElementById('outEdu').innerText = document.getElementById('inEdu').value;
            document.getElementById('outAbout').innerText = document.getElementById('inAbout').value;
            document.getElementById('outPhone').innerText = document.getElementById('inPhone').value;
            document.getElementById('outEmail').innerText = document.getElementById('inEmail').value;
            
            const skillsArr = document.getElementById('inSkills').value.split(',');
            document.getElementById('outSkills').innerHTML = skillsArr.map(s => s.trim() ? `<span class="skill-tag">${s.trim()}</span>` : '').join('');

            // انيميشن التحميل
            btn.disabled = true;
            status.innerText = "جاري المعالجة بدقة عالية...";
            status.style.color = "var(--primary)";
            
            let p = 0;
            const inv = setInterval(async () => {
                p += 10;
                bar.style.width = p + "%";
                if(p >= 100) {
                    clearInterval(inv);
                    
                    const canvas = await html2canvas(document.getElementById('cv-target'), { scale: 3, useCORS: true });
                    const imgData = canvas.toDataURL('image/png');
                    const pdf = new jspdf.jsPDF('p', 'mm', 'a4');
                    pdf.addImage(imgData, 'PNG', 0, 0, 210, 297);
                    pdf.save(`CV_${document.getElementById('inName').value || 'User'}.pdf`);

                    bar.style.width = "0%";
                    btn.disabled = false;
                    status.innerText = "✅ تم استخراج الملف بنجاح!";
                    status.style.color = "#059669";
                }
            }, 60);
        }
    </script>
</body>
</html>
